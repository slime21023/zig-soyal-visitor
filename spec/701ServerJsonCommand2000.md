# SOYAL 701Server Json 格式萬用指令 2000 範例教學

**版本：** 1.01  
**日期：** 2024年9月24日

---

## 📋 用途說明

SOYAL 支援第三方軟體平台透過 JSON 指令與 SOYAL 多功能控制器與工業版系列設備整合。第三方軟體可透過 SOYAL 軟體 701ServerSQL 發送 JSON 指令給 SOYAL 設備，由第三方軟體平台同時監控現場設備狀態。

**適用場景：**
- 訪客管理系統
- 考勤系統
- BMS 系統整合

---

## 🔧 支援的指令列表

| C_CMD 值 | 功能說明 |
|---------|---------|
| 1000 | 讀取主控軟體資料 |
| 1001 | 讀取控制器類型與連線狀態 |
| 1002 | 讀取遠端控制器 I/O 狀態 |
| 1003 | 讀取遠端控制器 I/O 狀態 |
| 1004 | 設定遠程控制器 I/O 狀態 |
| 1021 | 設定訪客卡片 UID 和日期時間限制 |
| 1022 | 刪除訪客卡片 UID 和日期時間限制 |
| 3002 | 創建事件紀錄 |
| 3003 | 設定控制器時間 |
| 2000 | HEX 格式的協議傳輸 |

---

## 🖥️ 硬體準備

### 支援設備
- **家用版：** Home H 系列控制器
- **企業版：** Enterprise E 控制器
- **多門控制器：** AR-716-E 系列
- **I/O 系列：** 401/403-IO 系列

### 特別注意
指令 1021（設定訪客使用者資料）和 1022（清除訪客使用者資料）僅支援：
- 企業版 Enterprise E 控制器
- 多門控制器 AR-716-E16

**範例使用設備：** AR-837E-A（企業版網絡型液晶顯示控制器）

---

## 💻 軟體準備

1. **SOYAL 701Server/701Client**
   - 版本：10V2
   - 支援模式：File base 檔案模式 & SQL Database 模式

2. **Json 格式轉換工具**
   - 線上工具：https://jsonlint.com/

3. **通訊協議文件**
   - 701Server Json Command 1V04.pdf

---

## ⚙️ 701Server 軟體設定

### 步驟 1：網路設定
- 選擇 **TCP/IP Only**
- 輸入本機電腦 IP Address 和 Port Number

### 步驟 2：控制器設定
- 選擇：881/837/331E&EF/82xEv5/721/725Ev2/727/327Hv5
- 輸入 IP Address
- Port：1621

### 步驟 3：確認通訊
- 確認控制器與 701Server 通訊正常

### 步驟 4：卡片格式設定
- 調整控制器 AR-837E-A 顯示的卡片格式為 **Hex**

---

## 📝 範例教學

### 範例 1：控制門鎖繼電器開/關

**功能：** 透過 Json 指令 "2000" 和通訊協定指令 21H 控制門鎖繼電器

**協議指令：** `7E 05 01 21 84 5B 01`

**JSON 指令格式：**
```json
{
    "l_user": "login user",
    "cmd_array": [{
        "c_cmd": 2000,
        "Area": 0,
        "Node": 1,
        "Hex": "0x2184"
    }]
}
```

**發送 (Tx)：**
```json
{"l_user":"login user","cmd_array":[{"c_cmd":2000,"Area":0,"Node":1,"Hex":"0x2184"}]}
```

**接收 (Rx)：**
```json
{"resp_array":[{"Area":0,"Hex":"0x7E0D000301440F901010000000262D","Node":1,"c_cmd":2000,"c_resp":3}]}
```

---

### 範例 2：設定訪客通行時間

**功能：** 透過 Json 指令 "2000" 和通訊協定指令 8BH 設定訪客資訊

**設定內容：**
- 用戶位址：200
- 卡片 ID：04295:14226
- 密碼：1212
- 通行模式：卡片和密碼
- 開始時間：2022/6/16 10:27
- 結束時間：2023/6/16 10:27
- 通行樓層：1F~8F

**協議指令：** `7E 26 01 8B 57 00 00 C8 00 00 00 00 10 C7 37 92 00 00 04 BC 86 FF FF FF 16 06 10 0A 1B 17 06 10 0A 1B 00 00 00 FF A7 D7`

**JSON 指令格式：**
```json
{
    "l_user": "login user",
    "cmd_array": [{
        "c_cmd": 2000,
        "Area": 0,
        "Node": 1,
        "Hex": "0x8B570000C80000000010C73792000004BC86FFFFFF1606100A1B1706100A1B000000FF"
    }]
}
```

**發送 (Tx)：**
```json
{"l_user":"login user","cmd_array":[{"c_cmd":2000,"Area":0,"Node":1,"Hex":"0x8B570000C80000000010C73792000004BC86FFFFFF1606100A1B1706100A1B000000FF"}]}
```

**接收 (Rx)：**
```json
{"resp_array":[{"Area":0,"Hex":"0x7E0F000401C2440F90101000000000E3AD","Node":1,"c_cmd":2000,"c_resp":3}]}
```

---

### 範例 3：設定控制器時間

**功能：** 透過 Json 指令 "2000" 和通訊協定 RTC 指令 23H 設定控制器時間

**協議指令：** `7E 0B 01 23 07 1B 0A 05 10 06 16 CE 4F`

**時間格式說明：**
- `07 1B 0A 05 10 06 16` (Hex) = `07 27 10 05 16 06 22` (Dec)
- 表示：2022年6月16日 10:27:07（秒.分.時.週.日.月.年）

**JSON 指令格式：**
```json
{
    "l_user": "login user",
    "cmd_array": [{
        "c_cmd": 2000,
        "Area": 0,
        "Node": 1,
        "Hex": "0x23071B0A05100616"
    }]
}
```

**發送 (Tx)：**
```json
{"l_user":"login user","cmd_array":[{"c_cmd":2000,"Area":0,"Node":1,"Hex":"0x23071B0A05100616"}]}
```

**接收 (Rx)：**
```json
{"resp_array":[{"Area":0,"Hex":"0x7E07000401DF341129","Node":1,"c_cmd":2000,"c_resp":3}]}
```

---

## 📌 重要提示

1. **指令格式：** 所有 Hex 值需以 "0x" 開頭
2. **參數說明：**
   - `l_user`：登入使用者
   - `c_cmd`：指令代碼
   - `Area`：區域編號
   - `Node`：節點編號
   - `Hex`：十六進制指令內容

3. **回應格式：** 系統會返回包含執行結果的 JSON 格式回應

4. **時間格式：** RTC 時間設定使用 Hex 格式，順序為秒.分.時.週.日.月.年

---

## 🔗 相關資源

- JSON 格式驗證工具：https://jsonlint.com/
- 詳細通訊協議請參考：701Server Json Command 1V04.pdf

---

## 📞 技術支援

如需更多技術支援或詳細資訊，請參考 SOYAL 官方文件或聯繫技術支援團隊。