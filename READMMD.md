# SOYAL è¨ªå®¢ç®¡ç† CLI å·¥å…·

åŸºæ–¼ Zig é–‹ç™¼çš„å‘½ä»¤åˆ—å·¥å…·ï¼Œé€é TCP å”å®šèˆ‡ SOYAL 701ServerSQL é€šè¨Šï¼Œå¯¦ç¾è¨ªå®¢ QR Code çš„è¨­å®šèˆ‡ç®¡ç†ã€‚

## âœ¨ ç‰¹è‰²

- ğŸš€ ä½¿ç”¨ Zig èªè¨€é–‹ç™¼ï¼Œé«˜æ•ˆèƒ½ã€ä½è³‡æºæ¶ˆè€—
- ğŸ”Œ åŸç”Ÿ TCP å”å®šé€šè¨Šï¼Œç„¡éœ€é¡å¤–ä¾è³´
- ğŸ“ æ”¯æ´è¨ªå®¢æ¬Šé™æ–°å¢èˆ‡åˆªé™¤
- ğŸ¯ ç°¡å–®æ˜“ç”¨çš„å‘½ä»¤åˆ—ä»‹é¢
- âš™ï¸ æ”¯æ´ç’°å¢ƒè®Šæ•¸è¨­å®š

## ğŸ“¦ å®‰è£

### å‰ç½®éœ€æ±‚
- Zig 0.11.0 æˆ–æ›´æ–°ç‰ˆæœ¬

### ç·¨è­¯
```bash
# å…‹éš†å°ˆæ¡ˆ
git clone <repository-url>
cd soyal-visitor-cli

# ç·¨è­¯
zig build

# ç·¨è­¯ä¸¦å®‰è£åˆ°ç³»çµ±
zig build -Doptimize=ReleaseSafe
```

ç·¨è­¯å¾Œçš„åŸ·è¡Œæª”ä½æ–¼ `zig-out/bin/soyal-visitor`

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬æŒ‡ä»¤

#### 1. æ–°å¢è¨ªå®¢æ¬Šé™
```bash
soyal-visitor add <å¡ç‰‡ID> <é–‹å§‹æ™‚é–“> <çµæŸæ™‚é–“> [å€åŸŸ] [ç¯€é»]
```

**ç¯„ä¾‹**ï¼š
```bash
# æ–°å¢è¨ªå®¢ï¼Œæœ‰æ•ˆæœŸé™ä¸€å¤©
soyal-visitor add QR123456 "2024-11-19 09:00:00" "2024-11-19 17:00:00"

# æŒ‡å®šå€åŸŸå’Œç¯€é»
soyal-visitor add QR789012 "2024-11-20 08:00:00" "2024-11-20 18:00:00" 0 1
```

#### 2. åˆªé™¤è¨ªå®¢æ¬Šé™
```bash
soyal-visitor delete <å¡ç‰‡ID> [å€åŸŸ] [ç¯€é»]
```

**ç¯„ä¾‹**ï¼š
```bash
# åˆªé™¤è¨ªå®¢æ¬Šé™
soyal-visitor delete QR123456

# æŒ‡å®šå€åŸŸå’Œç¯€é»
soyal-visitor delete QR789012 0 1
```

#### 3. é¡¯ç¤ºèªªæ˜
```bash
soyal-visitor help
```

## âš™ï¸ è¨­å®š

### ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸åç¨± | èªªæ˜ | é è¨­å€¼ |
|---------|------|--------|
| `SOYAL_HOST` | 701ServerSQL ä¸»æ©Ÿä½å€ | 127.0.0.1 |
| `SOYAL_PORT` | 701ServerSQL é€£æ¥åŸ  | 7010 |
| `SOYAL_USER` | ç™»å…¥ä½¿ç”¨è€…åç¨± | admin |

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```bash
# é€£æ¥åˆ°é ç«¯ä¼ºæœå™¨
export SOYAL_HOST=192.168.1.100
export SOYAL_PORT=7010
export SOYAL_USER=admin

soyal-visitor add QR001 "2024-11-19 09:00:00" "2024-11-19 17:00:00"
```

æˆ–å–®æ¬¡ä½¿ç”¨ï¼š
```bash
SOYAL_HOST=192.168.1.100 soyal-visitor add QR001 "2024-11-19 09:00:00" "2024-11-19 17:00:00"
```

## ğŸ“Š JSON æŒ‡ä»¤èªªæ˜

### æ–°å¢è¨ªå®¢ (c_cmd: 1021)
```json
{
  "l_user": "admin",
  "cmd_array": [{
    "c_cmd": 1021,
    "Area": 0,
    "Node": 1,
    "CardID": "QR123456",
    "StartTime": "2024-11-19 09:00:00",
    "EndTime": "2024-11-19 17:00:00"
  }]
}
```

### åˆªé™¤è¨ªå®¢ (c_cmd: 1022)
```json
{
  "l_user": "admin",
  "cmd_array": [{
    "c_cmd": 1022,
    "Area": 0,
    "Node": 1,
    "CardID": "QR123456"
  }]
}
```

### å›æ‡‰æ ¼å¼
```json
{
  "resp_array": [{
    "c_cmd": 1021,
    "c_resp": 3,
    "Area": 0,
    "Node": 1
  }]
}
```

**c_resp ç‹€æ…‹ç¢¼**ï¼š
- `3`: åŸ·è¡ŒæˆåŠŸ âœ…
- å…¶ä»–: åŸ·è¡Œå¤±æ•— âŒ

## ğŸ”§ é–‹ç™¼

### å°ˆæ¡ˆçµæ§‹
```
soyal-visitor-cli/
â”œâ”€â”€ build.zig          # å»ºç½®è¨­å®š
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.zig       # ä¸»ç¨‹å¼èˆ‡ CLI ä»‹é¢
â”‚   â”œâ”€â”€ client.zig     # TCP å®¢æˆ¶ç«¯
â”‚   â”œâ”€â”€ commands.zig   # æŒ‡ä»¤è™•ç†é‚è¼¯
â”‚   â””â”€â”€ types.zig      # è³‡æ–™çµæ§‹å®šç¾©
â””â”€â”€ README.md
```

### åŸ·è¡Œæ¸¬è©¦
```bash
# é–‹ç™¼æ¨¡å¼åŸ·è¡Œ
zig build run -- help

# æ¸¬è©¦æ–°å¢è¨ªå®¢
zig build run -- add TEST001 "2024-11-19 09:00:00" "2024-11-19 17:00:00"

# æ¸¬è©¦åˆªé™¤è¨ªå®¢
zig build run -- delete TEST001
```

## ğŸ“ æ³¨æ„äº‹é …

1. **æ™‚é–“æ ¼å¼**ï¼šå¿…é ˆä½¿ç”¨ `YYYY-MM-DD HH:MM:SS` æ ¼å¼
2. **ç¶²è·¯é€£ç·š**ï¼šç¢ºä¿èƒ½é€£æ¥åˆ° 701ServerSQL ä¼ºæœå™¨
3. **æ¬Šé™**ï¼šéœ€è¦æœ‰æ•ˆçš„ç™»å…¥ä½¿ç”¨è€…åç¨±
4. **å¡ç‰‡ ID**ï¼šå»ºè­°ä½¿ç”¨å”¯ä¸€è­˜åˆ¥ç¢¼ï¼ˆå¦‚ QR Code å…§å®¹ï¼‰

## ğŸ› ç–‘é›£æ’è§£

### é€£ç·šå¤±æ•—
```
error: ConnectionRefused
```
**è§£æ±ºæ–¹å¼**ï¼š
- æª¢æŸ¥ 701ServerSQL æ˜¯å¦æ­£åœ¨åŸ·è¡Œ
- ç¢ºèªä¸»æ©Ÿä½å€å’Œé€£æ¥åŸ è¨­å®šæ­£ç¢º
- æª¢æŸ¥é˜²ç«ç‰†è¨­å®š

### æŒ‡ä»¤åŸ·è¡Œå¤±æ•— (c_resp != 3)
**å¯èƒ½åŸå› **ï¼š
- å¡ç‰‡ ID æ ¼å¼éŒ¯èª¤
- æ™‚é–“æ ¼å¼ä¸æ­£ç¢º
- æ§åˆ¶å™¨ç¯€é»ä¸å­˜åœ¨
- æ¬Šé™ä¸è¶³

## ğŸ“š åƒè€ƒè³‡æ–™

- [SOYAL å®˜æ–¹æ–‡ä»¶](https://www.soyal.com/article.php?act=view&id=84)
- [701ServerSQL JSON Command èªªæ˜](https://files.soyal.com.tw/EN/download/Cross-System%20Integration/701Server%20Json%20Command%201V05.pdf)
- [Zig èªè¨€å®˜æ–¹æ–‡ä»¶](https://ziglang.org/documentation/master/)

## ğŸ“„ æˆæ¬Š

MIT License

## ğŸ¤ è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**é–‹ç™¼è€…**: åŸºæ–¼ SOYAL 701ServerSQL JSON Command è¦æ ¼é–‹ç™¼
**ç‰ˆæœ¬**: 1.0.0